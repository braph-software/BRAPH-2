clear variables %#ok<*NASGU>

%%
load('MP_coreperiphery.mat')

%% create a pipeline
pipeline = Pipeline();
pipeline.set('LABEL', 'Pipeline Connectivity-Functional Multiplex BUD');
pipeline.set('NOTES', 'Pipeline Connectivity-Functional Multiplex BUD with the comparison of Core-Periphery for BRAPH 2 publication');
pipeline.set('PS_DICT', Pipeline.getPropDefault('PS_DICT'))

% atlas
ps1 = PipelineSection('ID', int2str(1), 'LABEL', 'Brain Atlas');
pipeline.get('PS_DICT').get('ADD', ps1);
ps1.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc1 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'ba', ...
    'TEXT_BEFORE_EXEC', 'Load Brain Atlas', ...
    'TEXT_AFTER_EXEC', 'Brain Atlas', ...
    'CODE', char("ImporterBrainAtlasXLS('WAITBAR', true).get('GET_FILE').get('BA')"), ...
    'EL', ba ...
    );
ps1.get('PC_DICT').get('ADD', pc1);

% Connectivity groups
ps2 = PipelineSection('ID', int2str(2), 'LABEL', 'Connectivity Groups');

pipeline.get('PS_DICT').get('ADD', ps2);
ps2.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc2 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'gr1_women_CON', ...
    'TEXT_BEFORE_EXEC', 'Load Group CON 1', ...
    'TEXT_AFTER_EXEC', 'Group CON 1', ...
    'CODE', char("ImporterGroupSubjectCON_XLS('BA', ba, 'WAITBAR', true).get('GET_DIR').get('GR')"), ...
    'EL', gr1_women_CON ...
    );
ps2.get('PC_DICT').get('ADD', pc2);

pc3 = PipelineCode( ...
    'ID', int2str(2), ...
    'MONIKER', 'gr2_men_CON', ...
    'TEXT_BEFORE_EXEC', 'Load Group CON 2', ...
    'TEXT_AFTER_EXEC', 'Group CON 2', ...
    'CODE', char("ImporterGroupSubjectCON_XLS('BA', ba, 'WAITBAR', true).get('GET_DIR').get('GR')"), ...
    'EL', gr2_men_CON ...
    );
ps2.get('PC_DICT').get('ADD', pc3);

% Functional groups
ps3 = PipelineSection('ID', int2str(3), 'LABEL', 'Functional Groups');

pipeline.get('PS_DICT').get('ADD', ps3);
ps3.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc4 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'gr1_women_FUN', ...
    'TEXT_BEFORE_EXEC', 'Load Group FUN 1', ...
    'TEXT_AFTER_EXEC', 'Group FUN 1', ...
    'CODE', char("ImporterGroupSubjectFUN_XLS('BA', ba, 'WAITBAR', true).get('GET_DIR').get('GR')"), ...
    'EL', gr1_women_FUN ...
    );
ps3.get('PC_DICT').get('ADD', pc4);

pc5 = PipelineCode( ...
    'ID', int2str(2), ...
    'MONIKER', 'gr2_men_FUN', ...
    'TEXT_BEFORE_EXEC', 'Load Group FUN 2', ...
    'TEXT_AFTER_EXEC', 'Group FUN 2', ...
    'CODE', char("ImporterGroupSubjectFUN_XLS('BA', ba, 'WAITBAR', true).get('GET_DIR').get('GR')"), ...
    'EL', gr2_men_FUN ...
    );
ps3.get('PC_DICT').get('ADD', pc5);

% Group Combination
ps4 = PipelineSection('ID', int2str(4), 'LABEL', 'Group Combination');

pipeline.get('PS_DICT').get('ADD', ps4);
ps4.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc4 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'gr1_women', ...
    'TEXT_BEFORE_EXEC', 'Combine Groups 1', ...
    'TEXT_AFTER_EXEC', 'Group CON-FUN_MP 1', ...
    'CODE', char("CombineGroups_CON_FUN_MP('GR_CON', gr1_women_CON, 'GR_FUN', gr1_women_FUN, 'WAITBAR', true).get('GR_CON_FUN_MP')"), ...
    'EL', gr1_women ...
    );
ps4.get('PC_DICT').get('ADD', pc4);

pc5 = PipelineCode( ...
    'ID', int2str(2), ...
    'MONIKER', 'gr2_men', ...
    'TEXT_BEFORE_EXEC', 'Combine Groups 2', ...
    'TEXT_AFTER_EXEC', 'Group CON-FUN_MP 2', ...
    'CODE', char("CombineGroups_CON_FUN_MP('GR_CON', gr2_men_CON, 'GR_FUN', gr2_men_FUN, 'WAITBAR', true).get('GR_CON_FUN_MP')"), ...
    'EL', gr2_men ...
    );
ps4.get('PC_DICT').get('ADD', pc5);

% Analysis
ps5 = PipelineSection('ID', int2str(5), 'LABEL', 'Analysis');

pipeline.get('PS_DICT').get('ADD', ps5);
ps5.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc6 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'analysis_women', ...
    'TEXT_BEFORE_EXEC', 'Analyze Group 1', ...
    'TEXT_AFTER_EXEC', 'Group 1 Analysis', ...
    'CODE', char("AnalyzeEnsemble_CON_FUN_MP_BUD('GR', gr1_women, 'DENSITIES', 1:1:2)"), ...
    'EL', analysis_women ...
    );
ps5.get('PC_DICT').get('ADD', pc6);

pc7 = PipelineCode( ...
    'ID', int2str(2), ...
    'MONIKER', 'analysis_men', ...
    'TEXT_BEFORE_EXEC', 'Analyze Group 2', ...
    'TEXT_AFTER_EXEC', 'Group 2 Analysis', ...
    'CODE', char("AnalyzeEnsemble_CON_FUN_MP_BUD('GR', gr2_men, 'TEMPLATE', analysis_women)"), ...
    'EL', analysis_men ...
    );
ps5.get('PC_DICT').get('ADD', pc7);

% Comparison
ps6 = PipelineSection('ID', int2str(6), 'LABEL', 'Comparison');

pipeline.get('PS_DICT').get('ADD', ps6);
ps6.set('PC_DICT', PipelineSection.getPropDefault('PC_DICT'));
pc8 = PipelineCode( ...
    'ID', int2str(1), ...
    'MONIKER', 'c_BUD', ...
    'TEXT_BEFORE_EXEC', 'Compare Groups', ...
    'TEXT_AFTER_EXEC', 'Groups Comparison', ...
    'CODE', char("CompareEnsemble('A1', analysis_women, 'A2', analysis_men)"), ...
    'EL', c_BUD ...
    );
ps6.get('PC_DICT').get('ADD', pc8);

%% Open the pipeline
gui = GUIElement('PE', pipeline);
gui.get('DRAW');
gui.get('SHOW')

%% Save the pipeline
fprintf('pipeline saving...\n')
tic
Element.save(pipeline, 'pipeline_CorePeriphery_MP.b2')
toc
fprintf('pipeline saved\n')

%% Load the pipeline
pipeline = Element.load('pipeline_CorePeriphery_MP.b2')
gui = GUIElement('PE', pipeline);
gui.get('DRAW');
gui.get('SHOW')