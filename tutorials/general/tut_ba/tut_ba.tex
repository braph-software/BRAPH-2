\documentclass[justified]{tufte-handout}
\usepackage{../braph2_tut}
%\geometry{showframe} % display margins for debugging page layout

\title{Brain Atlas}

\begin{document}

\maketitle
	
\fig{marginfigure}
	{fig:01}
	{\includegraphics{fig01.jpg}}
	{Brain atlas figure created with BRAPH~2.0}
	{
	Example of a brain surface image with some nodes representing brain regions.
	}
#!01_300px
\begin{abstract}
\noindent
This Tutorial explains how to work with the Graphical User Interface (GUI) to manage brain atlases.
This is typically the first step required to perform a graph analysis in BRAPH~2.0. 
In this Tutorial, we will explain you how to upload a brain atlas, how to visualize it, and how to export publication-ready brain figures.
\end{abstract}

\tableofcontents

\fig{figure*}
	{fig:02}
	{\includegraphics[height=10cm]{fig02.jpg}}
	{Brain Atlas GUI}
	{
	Full graphical user interface to work with a brain atlas in BRAPH~2.0. 
	}
#!02
\clearpage
\section{Open the GUI}

The brain atlas GUI is the first step in most BRAPH~2.0 pipelines. You can open it by typing \code{braph2} in MatLab's terminal, which allows you to select a pipeline containing the steps required to perform your analysis. The initial step is typically to upload the brain atlas directly (\Figref{fig:03}c-d) after clicking ``Load Atlas''. 

\fig{figure*}
	{fig:03}
	{
	[h!]
	\includegraphics[height=10cm]{fig03.jpg}
	}
	{Upload a brain atlas}
	{
	The different steps you need to follow to open a brain atlas using the GUI: 
	{\bf a} Open the brain atlas GUI.
	{\bf b} Import a brain atlas from an XLS or TXT file.
	{\bf c} Navigate to the BRAPH~2.0 folder \fn{atlases}.
	{\bf d} Select the desired atlas.
	}
#!03

\begin{tcolorbox}[
	title=Brain Atlas GUI launch from command line
]
You can also open the GUI and upload the brain atlas using the command line (i.e., without opening an analysis pipeline) by typing the commands in \Coderef{cd:launch}. In this case, you can upload the atlas as shown in \Figref{fig:03}a-d.

\begin{lstlisting}[
	label=cd:launch,
	caption={
		{\bf Code to launch the Brain Atlas GUI.}
		This code can be used in the MatLab command line to launch the  Brain Atlas GUI without having to open a pipeline.
	}
]
ba = BrainAtlas();

gui = GUIElement('PE', ba);
gui.get('DRAW')
gui.get('SHOW')
\end{lstlisting}
\end{tcolorbox}

\clearpage
\section{Upload the Brain Atlas}

In the GUI launched in the previous step, you have a menu that can be used to import a brain atlas (\Figref{fig:03}b) either by loading one of the already-available atlases in the BRAPH~2.0 folder \fn{atlases} (\Figref{fig:03}c) or by loading a file you have created. In this example, we are uploading the Desikan atlas (\Figref{fig:03}d).

You can change the ID, name, and notes of the brain atlas (as shown in \Figref{fig:04}a) as well as the IDs, labels, coordinates, and notes of the brain regions (\Figref{fig:04}b).
	
\fig{figure*}
	{fig:04}
	{
	[h!]
	\includegraphics{fig04.png}
	}
	{Edit the brain atlas information}
	{
	In the brain atlas GUI: 
	{\bf a} We can see the ID, name, brain regions and notes of the brain atlas.
	{\bf b} All of this information can be changed, in this example we have renamed the ID, name and notes of the brain atlas but you can also edit the IDs, labels, coordinates, and notes of the brain regions.
	}
#!04

\section{Ready Brain Atlases}

\fig{figure}
	{fig:05}
	{
	[b!]
	\includegraphics{fig05.jpg}
	}
	{Brain Atlases}
	{
	Some brain atlases provided by BRAPH~2.0: \\
	{\bf AAL90} Automated Anatomical Labelling atlas with 90 cortical and subcortical regions.\\
	{\bf AAL116} Automated Anatomical Labelling atlas with 116 cortical and subcortical regions, including cerebellar areas.\\
	{\bf BNA} Brainnetome atlas with 246 cortical and subcortical regions.\\
	{\bf Craddock} Functional atlas with 200 cortical and subcortical regions, including cerebellar areas.\\
	{\bf Desikan} Anatomical atlas with 68 cortical from the FreeSurfer software.\\
	{\bf Destrieux} Anatomical atlas with 148 cortical from the FreeSurfer software.\\
	{\bf Schaefer} Functional brain atlas with 200 cortical regions that belong to 7 different resting-state fMRI networks.\\
	{\bf Subcortical FreeSurfer} Anatomical atlas with 14 subcortical gray matter regions from the FreeSurfer software.
	}

Currently, we provide several brain atlases that are commonly used in the field of brain connectomics, some of which are shown in \Figref{fig:05}). 
They are available in the BRAPH~2.0 folder \fn{atlases} in XLS and TXT formats, and they can also can be downloaded from our website (\url{http://braph.org/software/brain-atlases/}).
#!05
\clearpage
\section{Create a New Brain Atlas}

To create a new brain Atlas in BRAPH~2.0 format, you should create a new XLS file (\fn{*.xls} or \fn{*.xlsx}), as shown in \Figref{fig:06}. 
(It is also possible to create it in TXT format (\fn{*.txt}), for which we refer to the examples available in the BRAPH~2.0 folder \fn{atlases}.)

\fig{figure*}
	{fig:06}
	{\includegraphics[height=10cm]{fig06.jpg}}
	{Create your own brain atlas}
	{
	Overview of how the XLS file containing your atlas information should look like.
	}
#!06
Start by writing the following information in the first 4 rows:
\begin{itemize}

\item Brain Atlas ID (row 1, column 1). 
For example: Desikan FreeSurfer

\item Brain Atlas LABEL (row 2, column 1). 
For example: Desikan Labels

\item Brain Atlas NOTES (row 3, column 1).
For example: Desikan Nodes

\item Brain Surface Name (row 4, column 1).
For example: BrainMeshICBM152.nv

\end{itemize}
Then, from row 5, you should include the IDs of the regions of your atlas ($1^{\rm st}$ column), the labels of the regions of your atlas ($2^{\rm nd}$ column), the X, Y and Z coordinates ($3^{\rm rd}$, $4^{\rm th}$, and $5^{\rm th}$ columns), and any relevant notes (in this case, the brain hemisphere, $6^{\rm th}$ column).	

\clearpage
\section{Plot the Brain Atlas}

Once you are satisfied with the brain atlas, you can plot it by pushing the button ``Plot Brain Atlas'' (\Figref{fig:07}a). 
This will open an image with a brain surface and nodes corresponding to the brain regions (\Figref{fig:07}b).

\fig{figure*}
	{fig:07}
	{\includegraphics[height=10cm]{fig07.jpg}}
	{Brain atlas visualization}
	{
	Plotting the nodes of a brain atlas on a 3D brain surface. 
	}
#!07
	
This new window has a large toolbar that allows you to change the visualization of the atlas. We suggest you try the different options to understand how they change the figure. Importantly, within this menu, there is one option called ``Settings Brain Surface'' (highlighted in \Figref{fig:08}a), which opens the settings window shown in \Figsref{fig:08}b-c.

\fig{figure*}
	{fig:08}
	{\includegraphics[height=10cm]{fig08.jpg}}
	{Visualize the brain atlas}
	{
	{\bf a} The ``Settings Brain Surface'' button in the toolbar opens {\bf b}-{\bf c} A window with the settings available for this brain figure.
	}

#!08

The settings window allows you to optimize how the brain regions included in your analysis are visualized. This is often included as a first figure in a manuscript.

Most things in the settings window are intuitive. So we encourage you to try them out until you achieve the visualization you want. There are many possibilities for visualization. \Figref{fig:09} shows just one example.
#!09
Each brain region can be represented with spheres, symbols, IDs, and labels.
Spheres are objects that are rendered in 3D --- often prettier, but also more computationally expensive.
Symbols are objects rendered in 2D --- more stylized and less computationally expensive.
IDs and labels are the texts associated to the brain region.

If you wish to apply some properties to a set of brain regions, you can select multiple regions by clicking on the checkboxes on the right, and then right-click and select ``apply to selection'' before applying some property.

\fig{figure}
	{fig:09}
	{\includegraphics[height=10cm]{fig09.jpg}}
	{Example of a visualization of the brain atlas}
	{
	A final figure was created with BRAPH~2.0 by changing different options in the menu.
	}

Importantly, BRAPH~2.0 provides different brain surfaces, as shown in \Figref{fig:10}, for the human brain and cerebellum in addition to animals such as the ferret, macaque, mouse, and rat.
It is also possible to add additional brain surfaces by adding the required NV files in the BRAPH~2.0 folder \fn{brainsurfs}.
#!10
\fig{figure}
	{fig:10}
	{\includegraphics{fig10.png}}
	{Brain surfaces in BRAPH~2.0}
	{
	Some of the brain surfaces available in BRAPH~2.0 to plot the brain atlas.
	}

\clearpage
\section{Export the Figure}

To export and save a (publication-ready) figure, you can select ``Print'' from the brain atlas GUI and select one of the various provided options \Figref{fig:11}.

\fig{figure*}
	{fig:11}
	{\includegraphics[height=10cm]{fig11.jpg}}
	{Save a brain atlas figure}
	{
	BRAPH~2.0 provides different options that allow saving a figure with different resolutions and color modes, adequate to any requirement for presentations and publications.
	}
#!11
\end{document}