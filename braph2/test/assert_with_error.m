function assert_with_error(code, error_identifier, varargin)
%ASSERT_WITH_ERROR checks whether an error is correctly thrown.
%
% ASSERT_WITH_ERROR(CODE, ERRID) checks whether the correct error with the
%  error identifier ERRID is thrown by the CODE (a string).
%
% ASSERT_WITH_ERROR(CODE, ERRID, VAR1, VAR2, ...) executes the CODE using
%  the variables VAR1, VAR2, ... which are referred to in the code string 
%  as 'varargin{1}', 'varargin{2}', ...
%
% Example:
% 
%  ASSERT_WITH_ERROR( ...
%	"el = TrialElement('TAG1', varargin(1), 'TAG2', varargin(2));", ...
%	'ERRID', ...
%	VAR1, VAR2 ...
%   )
%
% See also test_braph2.

try % tries the code, it is expected to throw an error    
    eval(code)
catch e  % catches the thrown error e, it compares the identifier with the expected error_identifier
    assert(isequal(e.identifier, error_identifier), ...
        [BRAPH2.STR ':assert_with_error:' BRAPH2.ERR_TRY], ...
        [BRAPH2.STR ':assert_with_error:' BRAPH2.ERR_TRY '\n' ...
        'Expected error: ' error_identifier '. Instead, thrown error ' e.identifier])    
end
% checks that the variable e exists in the workspace 
assert(exist('e', 'var') == 1, ...
    [BRAPH2.STR ':assert_with_error:' BRAPH2.ERR_TRY], ...
	[BRAPH2.STR ':assert_with_error:' BRAPH2.ERR_TRY '\n' ...
	'Error not thrown. Expected error: ' error_identifier])
end